schema Users {
    id: int;
    name: string;
    age: int;
    status: string;
}

source users_db <- Postgres(
    host: "localhost",
    database: "postgres",
    user: "postgres",
    password: env("POSTGRES_PASSWORD"),
    table: "users"
) using Users;

// NEW: Define a sink (the destination file)
sink summary_report -> File(path: "summary_report.csv");

// This part is the same: calculate the summary and save to a variable
user_summary = users_db
    -> group_by(status)
    -> aggregate(
        user_count = count(),
        average_age = avg(age)
    );

// NEW: Add this final pipeline to write the variable to the sink
user_summary -> summary_report;